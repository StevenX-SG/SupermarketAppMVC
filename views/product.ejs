<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <title>FairPrime Market - Product Details</title>
</head>
<body>
  <%- include('partials/header') %>

  <div class="container mt-4">
    <p>Welcome, <%= user.username %> (<%= user.role %>)</p>

    <div class="mb-4 text-center">
      <h2>Product Details</h2>
    </div>

    <% if (product) { %>
      <div class="row justify-content-center">
        <!-- LEFT: Image -->
        <div class="col-md-5 text-center mb-3">
          <% 
            let img = "";
            if (product.image) {
              img = product.image.startsWith("http")
                ? product.image
                : "/images/" + product.image;
            }
          %>
          <% if (img) { %>
            <img src="<%= img %>" class="img-fluid border" style="max-height: 350px; object-fit: contain;">
          <% } else { %>
            <div class="text-muted">No image</div>
          <% } %>
        </div>

        <!-- RIGHT: Info + actions -->
        <div class="col-md-5">
          <h3><%= product.productName %></h3>

          <p class="mb-1">
            <strong>Category:</strong>
            <%= product.category || 'N/A' %>
          </p>
          <p class="mb-1">
            <strong>Tag:</strong>
            <%= product.tags || 'N/A' %>
          </p>
          <p class="mb-1">
            <strong>Available stock:</strong>
            <%= product.quantity %>
          </p>

          <h4 class="text-danger mt-3">
            $<%= Number(product.price).toFixed(2) %>
          </h4>

          <!-- Actions differ by role -->
          <% if (user.role === 'user') { %>
            <!-- Add to Cart -->
            <form method="POST" action="/add-to-cart/<%= product.id %>" class="d-flex align-items-center gap-2 mt-3">
              <label class="mb-0">Qty:</label>
              <input
                type="number"
                name="quantity"
                value="1"
                min="1"
                max="<%= product.quantity %>"
                class="form-control"
                style="width: 90px;"
              >
              <button type="submit" class="btn btn-success flex-grow-1">
                Add to cart
              </button>
            </form>

            <!-- Wishlist -->
            <form method="POST" action="/wishlist/add/<%= product.id %>" class="mt-2">
              <button type="submit" class="btn btn-outline-danger">
                â™¥ Add to wishlist
              </button>
            </form>
          <% } else { %>
            <!-- Admin view: no cart, just info -->
            <div class="alert alert-info mt-3 mb-0">
              Admin view: product details only.
            </div>
          <% } %>

          <!-- Optional description (if you add this column later) -->
          <% if (product.description) { %>
            <div class="mt-4">
              <h6>Description</h6>
              <p class="mb-0"><%= product.description %></p>
            </div>
          <% } %>
        </div>
      </div>
    <% } else { %>
      <p>No product found.</p>
    <% } %>

    <!-- Back button -->
    <div class="mt-4">
      <% if (user.role === 'admin') { %>
        <a href="/inventory" class="btn btn-secondary">Back</a>
      <% } else { %>
        <a href="/shopping" class="btn btn-secondary">Back</a>
      <% } %>
    </div>
  </div>

  <%- include('partials/footer') %>
</body>
</html>
