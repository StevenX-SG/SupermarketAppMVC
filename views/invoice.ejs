<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FairPrime Market - Invoice</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

  <%- include('partials/header') %>

  <div class="container mt-5">
    <h2 class="text-center mb-4">Invoice - Order <%= order.id %></h2>

    <div class="mb-4">
      <p><b>Customer ID:</b> <%= order.userId %></p>
      <p><b>Order Date:</b> <%= order.createdAt %></p>
      <p><b>Total (from DB):</b> $<%= Number(order.totalAmount || 0).toFixed(2) %></p>
    </div>

    <table class="table table-bordered text-center">
      <thead class="table-light">
        <tr>
          <th>Image</th>
          <th>Product Name</th>
          <th>Quantity</th>
          <th>Unit Price</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <% let subtotal = 0; %>
        <% (items || []).forEach(item => { %>
          <tr>
            <td>
              <img
                src="<%= item.image && item.image.startsWith('http') ? item.image : '/images/' + item.image %>"
                width="60"
              >
            </td>
            <td><%= item.productName %></td>
            <td><%= item.quantity %></td>
            <td>$<%= Number(item.price || 0).toFixed(2) %></td>
            <td>
              <% const lineTotal = (item.quantity || 0) * (item.price || 0); %>
              $<%= lineTotal.toFixed(2) %>
              <% subtotal += lineTotal; %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>

    <div class="text-end mt-3">
      <% const gst = subtotal * 0.09; %>
      <p>Subtotal (from items): $<%= subtotal.toFixed(2) %></p>
      <p>GST (9%): $<%= gst.toFixed(2) %></p>
      <h4>Grand Total: $<%= (subtotal + gst).toFixed(2) %></h4>
    </div>

    <div class="mt-4">
      <a href="/admin" class="btn btn-secondary">Back to Dashboard</a>
    </div>
  </div>

  <%- include('partials/footer') %>
</body>
</html>
